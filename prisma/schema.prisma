
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Course {
   id           String   @id @default(cuid())
   name         String   @unique
   totalHours   Int
   startDate    DateTime @map("start_date")
   endDate      DateTime @map("end_date")
   students     Student[]

   @@map("courses")
}

model Student {
    id             String   @id @default(cuid())
    fullName       String   @map("full_name")
    cpf            String?  @unique
    guardian       String?
    fatherName     String?  @map("father_name")
    motherName     String?  @map("mother_name")
    phone          String
    birthDate      DateTime  @map("birth_date")
    courseId        String    @map("course_id")
    courseStartDate DateTime?  @map("course_start_date")
    courseEndDate  DateTime?  @map("course_end_date")
    schedule       String?   // JSON string: {"monday": ["mon-08-09"], "wednesday": ["wed-14-15"]}
    email          String?   @unique
    cep            String?
    street         String?
    number         String?
    neighborhood   String?
    city           String?
    state          String?
    isCompleted    Boolean   @default(false) @map("is_completed")
    completionDate DateTime? @map("completion_date")

    course         Course @relation(fields: [courseId], references: [id])
    attendances    AttendanceRecord[]

    @@map("students")
    @@index([courseId], name: "students_course_id_idx")
}

model AttendanceRecord {
    id         String   @id @default(cuid())
    studentId  String   @map("student_id")
    date       DateTime
    status     String
    classHours Int      @map("class_hours")

    student    Student  @relation(fields: [studentId], references: [id])

    @@map("attendance_records")
    @@index([studentId], name: "attendance_records_student_id_idx")
}
model TimeSlotCapacity {
    id           String   @id @default(cuid())
    slotId       String   @map("slot_id") // ID do horário (ex: 'mon-08-09')
    day          String   // Dia da semana (monday, tuesday, etc)
    time         String   // Horário (ex: '08:00 - 09:00')
    totalVacancies Int    @map("total_vacancies") // Total de vagas disponíveis
    createdAt    DateTime @default(now()) @map("created_at")
    updatedAt    DateTime @updatedAt @map("updated_at")

    @@map("time_slot_capacities")
    @@unique([slotId])
    @@index([day], name: "time_slot_capacities_day_idx")
}